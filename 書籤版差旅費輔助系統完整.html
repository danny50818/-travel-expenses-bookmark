<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·®æ—…è²»æ ¸éŠ·ç³»çµ± (V65 ç©©å®šç‰ˆ)</title>
    <style>
        body { font-family: "Microsoft JhengHei", "Segoe UI", sans-serif; background: #f0f2f5; padding: 40px; color: #333; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 50px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        
        h1 { color: #2c3e50; text-align: center; margin-bottom: 20px; }
        
        /* å®‰è£å€ */
        .install-box { 
            background: #fff8f0; border: 3px dashed #d35400; border-radius: 12px; 
            padding: 40px; text-align: center; margin-bottom: 40px;
        }
        
        .bookmark-btn {
            display: inline-block; padding: 18px 50px; margin-top: 15px;
            background: linear-gradient(135deg, #d35400, #e67e22);
            color: white; text-decoration: none; 
            border-radius: 50px; font-weight: bold; font-size: 1.6em;
            box-shadow: 0 8px 20px rgba(211, 84, 0, 0.4);
            cursor: move; /* é¡¯ç¤ºæ‹–æ›³æ‰‹å‹¢ */
        }
        .bookmark-btn:hover { transform: scale(1.05); }
        
        .arrow { font-size: 2em; color: #d35400; animation: bounce 1s infinite; display: block; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* æ­¥é©Ÿèªªæ˜å€ (æ–¹æ ¼æ¨£å¼) */
        .steps-header { font-size: 1.4em; color: #2c3e50; font-weight: bold; margin-bottom: 15px; border-left: 5px solid #2c3e50; padding-left: 10px; }
        
        .steps-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        
        .step-card { 
            background: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 10px; padding: 20px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: transform 0.2s;
        }
        .step-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        
        .step-title { 
            font-weight: bold; font-size: 1.2em; color: #fff; background: #34495e; 
            padding: 5px 15px; border-radius: 20px; display: inline-block; margin-bottom: 15px;
        }
        
        .step-content { font-size: 1em; color: #555; text-align: justify; }
        .highlight { color: #c0392b; font-weight: bold; background: #fff5f5; padding: 0 4px; }
        .icon { font-size: 1.2em; vertical-align: middle; margin-right: 5px; }

        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {
            .steps-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸš€ å·®æ—…è²»æ ¸éŠ·ç³»çµ± (V65 ç©©å®šç‰ˆ)</h1>

    <div class="install-box">
        <span class="arrow">â¬‡ï¸ è«‹å°‡æŒ‰éˆ•æ‹–æ›³è‡³æ›¸ç±¤åˆ— â¬‡ï¸</span>
        <a id="theBookmark" href="#" class="bookmark-btn" onclick="alert('è«‹ä¸è¦é»æ“Šï¼\nè«‹ç›´æ¥ã€Œæ‹–æ›³ã€æŒ‰éˆ•åˆ°ä¸Šæ–¹çš„æ›¸ç±¤åˆ—æ”¾é–‹å³å¯ã€‚');return false;">ğŸš€ å·®æ—…ç¥ç®— V65</a>
        <p style="margin-top:15px; color:#d35400; font-weight:bold;">
            è«‹æŒ‰ä½æ»‘é¼ å·¦éµï¼Œç›´æ¥æ‹–åˆ°ç€è¦½å™¨çš„æ›¸ç±¤åˆ—æ”¾é–‹ã€‚
        </p>
    </div>

    <div class="steps-header">ğŸ“– ä½¿ç”¨æ­¥é©Ÿ</div>
    <div class="steps-grid">
        
        <div class="step-card">
            <div class="step-title" style="background:#2980b9;">1. è¤‡è£½è¡Œç¨‹</div>
            <div class="step-content">
                åœ¨ WebITR å·®å‹¤ç³»çµ±è²»ç”¨é é¢ï¼ˆé‚„ä¸ç”¨é»é–‹ç”³è«‹ï¼‰ï¼š
                <br><br>
                é»æ“Šæ›¸ç±¤ <b style="color:#2980b9">å·®æ—…ç¥ç®—V65</b>
                <br>â†“<br>
                é»æ“Šé¢æ¿ä¸Šçš„ <b>[ğŸ“‹ è¤‡è£½è¡Œç¨‹]</b>ã€‚
            </div>
        </div>

        <div class="step-card">
            <div class="step-title" style="background:#27ae60;">2. åœ°åœ–è¨ˆç®—</div>
            <div class="step-content">
                åˆ° Google Maps é»æ“Šæ›¸ç±¤ï¼š
                <ul style="padding-left: 20px; margin: 10px 0;">
                    <li>é» <b>[è²¼ä¸Šè³‡æ–™]</b> ä¸¦è¦åŠƒè·¯ç·šã€‚</li>
                    <li>é»ä¸‹æ–¹è©³ç´°è³‡æ–™ç”¢ç”Ÿå®Œæ•´è·é›¢ã€‚</li>
                    <li>é» <b>[ğŸ“ æŠ“å–]</b>ã€‚</li>
                    <li>å…¨éƒ¨å®Œæˆå¾Œé» <b>[ğŸ“¤ è¤‡è£½çµæœ]</b>ã€‚</li>
                </ul>
            </div>
        </div>

        <div class="step-card">
            <div class="step-title" style="background:#c0392b;">3. è‡ªå‹•å¡«å¯«</div>
            <div class="step-content">
                å›åˆ° WebITR å·®å‹¤ç³»çµ±è²»ç”¨é é¢ï¼š
                <br><br>
                <span class="highlight">âš ï¸ è«‹å‹™å¿…å±•é–‹æ‰€æœ‰ç”³è«‹</span>
                <br>â†“<br>
                é»æ“Šæ›¸ç±¤ <b style="color:#c0392b">å·®æ—…ç¥ç®—V65</b>
                <br>â†“<br>
                é»æ“Š <b>[ğŸš€ ä¸€éµè‡ªå‹•å¡«å¯«]</b>ã€‚
            </div>
        </div>

    </div>
</div>

<script>
/* V65 æ ¸å¿ƒç¨‹å¼ç¢¼ (åŸå§‹é‚è¼¯ - ä¸æ›´å‹•) */
const v65Raw = `(function(){
    var isMap = window.location.href.indexOf('google') > -1 && window.location.href.indexOf('maps') > -1;
    
    if(isMap){
        /* === åœ°åœ–ç«¯é‚è¼¯ === */
        var old = document.getElementById('v65-copilot');
        if(old) document.body.removeChild(old);

        var box = document.createElement('div');
        box.id = 'v65-copilot';
        Object.assign(box.style, {
            position:'fixed', top:'10px', right:'10px', width:'420px', 
            backgroundColor:'white', border:'3px solid #8e44ad', zIndex:'2147483647',
            borderRadius:'8px', padding:'10px', boxShadow:'0 10px 40px rgba(0,0,0,0.5)',
            fontFamily:'Arial, sans-serif', maxHeight:'90vh', overflowY:'auto'
        });

        var html = '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;border-bottom:1px solid #eee;padding-bottom:5px;">';
        html += '<h3 style="margin:0;color:#8e44ad;font-size:16px;">ğŸ—ºï¸ åœ°åœ–å‰¯é§•é§› V65</h3>';
        html += '<button id="v65-close" style="background:none;border:none;font-size:18px;cursor:pointer;color:#999;">&times;</button>';
        html += '</div>';
        html += '<div id="v65-list" style="min-height:50px;"></div>';
        html += '<div style="margin-top:10px;display:flex;gap:5px;">';
        html += '<button id="v65-paste" style="flex:1;padding:10px;background:#34495e;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:bold;">ğŸ“‹ è²¼ä¸Šè³‡æ–™</button>';
        html += '<button id="v65-export" style="flex:1;padding:10px;background:#e67e22;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:bold;">ğŸ“¤ è¤‡è£½çµæœ</button>';
        html += '</div>';

        box.innerHTML = html;
        document.body.appendChild(box);

        var tripData = [];

        document.getElementById('v65-close').onclick = function(){ document.body.removeChild(box); };
        
        document.getElementById('v65-paste').onclick = function(){
            navigator.clipboard.readText().then(text => {
                try { tripData = parse(JSON.parse(text)); recalcAll(); render(); } 
                catch(e) { manualPaste(); }
            }).catch(e => manualPaste());
        };

        function manualPaste(){
            var v = prompt('âš ï¸ è«‹æŒ‰ Ctrl+V è²¼ä¸Šè³‡æ–™ï¼š');
            if(v) { try{ tripData = parse(JSON.parse(v)); recalcAll(); render(); }catch(err){alert('æ ¼å¼éŒ¯èª¤');} }
        }

        document.getElementById('v65-export').onclick = function(){
            if(tripData.length===0) return;
            var incomplete = tripData.filter(t => t.headingKm <= 0);
            if(incomplete.length > 0 && !confirm('âš ï¸ å°šæœ‰ '+incomplete.length+' ç­†æœªæŠ“å–é‡Œç¨‹ï¼Œç¢ºå®šåŒ¯å‡ºï¼Ÿ')) return;
            recalcAll();
            var out = tripData.map(t => ({
                rawReason: t.rawReason, note: t.noteText, car: t.carFee, scooter: t.scooterFee, misc: t.finalMisc
            }));
            /* Create temp textarea to copy */
            var el = document.createElement('textarea');
            el.value = JSON.stringify(out);
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            alert('âœ… å·²è¤‡è£½ï¼è«‹å› WebITR ä½¿ç”¨ [ä¸€éµè‡ªå‹•å¡«å¯«]ã€‚');
        };

        function parse(raw){
            return raw.map((r, i) => {
                var m = r.match(/(\\d{1,2}-\\d{1,2}).*?(\\d{2}:\\d{2})\\s*~\\s*(\\d{1,2}-\\d{1,2}).*?(\\d{2}:\\d{2})/);
                var v = r.includes('æ©Ÿè»Š')?'scooter':(r.includes('å…¬å‹™è»Š')||r.includes('å®¢é‹')?'official':'car');
                var reason = r.replace(/^\\d+\\s*å…ƒ/, '').trim();
                var pIdx = reason.lastIndexOf(')');
                if(pIdx>-1 && pIdx<reason.length-1) reason = reason.substring(pIdx+1).trim();
                var tStr = m ? m[2]+'~'+m[4] : '';
                var duration = 0;
                if(m){
                    var t1 = new Date('2000/01/01 ' + m[2]);
                    var t2 = new Date('2000/01/01 ' + m[4]);
                    duration = (t2 - t1) / 36e5;
                    if(duration < 0) duration += 24;
                }
                return { 
                    id:i, date:m?m[1]:'??', timeStr:tStr, duration: duration, 
                    vehicle:v, reason:reason, rawReason:reason, 
                    headingKm:0, totalKm:0, 
                    isRound:true, carFee:0, scooterFee:0, finalMisc:0, rawMisc:0, note:'',
                    isCapped: false
                };
            });
        }

        function render(){
            var el = document.getElementById('v65-list');
            if(tripData.length===0) { el.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">è«‹å…ˆé»æ“Š [è²¼ä¸Šè³‡æ–™]</div>'; return; }
            el.innerHTML = '';
            tripData.forEach((t, i) => {
                var isDone = t.headingKm > 0;
                var row = document.createElement('div');
                var border = isDone ? '5px solid #27ae60' : '5px solid #e74c3c';
                var bg = isDone ? '#f0fbf5' : '#fff5f5';
                row.style.cssText = 'background:'+bg+';border:1px solid #ccc;border-left:'+border+';padding:10px;margin-bottom:8px;border-radius:4px;box-shadow:0 2px 5px rgba(0,0,0,0.05);text-align:left;';
                
                var headerHtml = '<div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:5px;">';
                headerHtml += '<div style="font-weight:bold;font-size:13px;color:#2c3e50;line-height:1.4;word-break:break-all;flex:1;">'+t.date+' '+t.reason+'</div>';
                /* Copy Reason Button */
                headerHtml += '<button id="v65-btn-cp-'+i+'" title="è¤‡è£½åœ°é»" style="margin-left:5px;background:none;border:1px solid #ccc;border-radius:3px;cursor:pointer;padding:2px 5px;">ğŸ“„</button>';
                headerHtml += '</div>';
                
                var actionHtml = '<div style="display:flex;justify-content:space-between;align-items:center;">';
                var modeBtnText = t.isRound ? 'ğŸ”„ åŸè·¯å¾€è¿”' : 'â¡ï¸ å–®å‘è¡Œç¨‹';
                var modeBtnColor = t.isRound ? '#3498db' : '#27ae60';
                actionHtml += '<button id="v65-btn-md-'+i+'" style="font-size:11px;background:'+modeBtnColor+';color:white;border:none;padding:4px 8px;border-radius:15px;cursor:pointer;min-width:80px;">'+modeBtnText+'</button>';
                
                var dispKm = t.headingKm > 0 ? t.headingKm+' KM' : '--';
                actionHtml += '<div style="display:flex;align-items:center;gap:5px;">';
                actionHtml += '<span style="font-size:12px;color:#555;font-weight:bold;" title="èªå®šå–®ç¨‹">'+dispKm+'</span>';
                if(t.headingKm > 0) {
                    actionHtml += '<button id="v65-btn-ed-'+i+'" title="ä¿®æ”¹å–®ç¨‹" style="background:none;border:1px solid #ccc;border-radius:50%;cursor:pointer;width:20px;height:20px;font-size:10px;line-height:16px;padding:0;color:#555;">âœï¸</button>';
                }
                actionHtml += '</div>';
                actionHtml += '<button id="v65-btn-gb-'+i+'" style="background:'+(isDone?'#95a5a6':'#c0392b')+';color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;font-size:12px;">ğŸ“ æŠ“å–</button>';
                actionHtml += '</div>';

                if(isDone){
                    var miscFeeStyle = t.isCapped ? 'color:#d35400;font-weight:bold;' : 'color:#555;';
                    var miscFeeText = t.isCapped ? t.finalMisc + ' (å·²å¹³å¸³)' : t.finalMisc;
                    actionHtml += '<div style="margin-top:5px;padding-top:5px;border-top:1px dashed #ccc;font-size:11px;color:#555;display:flex;justify-content:space-between;">';
                    actionHtml += '<span>'+(t.vehicle==='car'?'ğŸš—':'ğŸ›µ')+' $'+(t.vehicle==='car'?t.carFee:t.scooterFee)+'</span>';
                    actionHtml += '<span style="'+miscFeeStyle+'">é›œè²» $'+miscFeeText+' <span style="font-weight:normal;color:#999;font-size:10px;">('+t.duration.toFixed(1)+'hr)</span></span>';
                    actionHtml += '</div>';
                }
                row.innerHTML = headerHtml + actionHtml;
                el.appendChild(row);

                /* Add Listeners dynamically to avoid global scope issues */
                document.getElementById('v65-btn-cp-'+i).onclick = function(){ 
                    var e=document.createElement('textarea');e.value=t.reason;document.body.appendChild(e);e.select();document.execCommand('copy');document.body.removeChild(e);
                };
                document.getElementById('v65-btn-md-'+i).onclick = function(){ t.isRound=!t.isRound; recalcAll(); render(); };
                document.getElementById('v65-btn-gb-'+i).onclick = function(){ grab(i); };
                if(document.getElementById('v65-btn-ed-'+i)){
                    document.getElementById('v65-btn-ed-'+i).onclick = function(){ 
                        var v = prompt('âœï¸ ä¿®æ”¹ [èªå®šå–®ç¨‹] (é›œè²»åŸºæº–)ï¼š', t.headingKm);
                        if(v!==null && !isNaN(v) && v!==''){ t.headingKm=parseFloat(v); if(!t.totalKm)t.totalKm=t.headingKm; recalcAll(); render(); }
                    };
                }
            });
        }

        function grab(i){
            var txt = document.body.innerText;
            var sb = document.querySelector('[role="main"], #pane, #box');
            if(sb) txt = sb.innerText;
            var regex = /([\\d\\.]+)\\s*(å…¬é‡Œ|km)/g;
            var matches = [...txt.matchAll(regex)];
            if(matches.length > 0){
                var values = matches.map(m => parseFloat(m[1]));
                var total = Math.max(...values);
                var lastLeg = 0;
                if(values.length > 1){
                    var candidate = values[values.length - 1];
                    if(candidate < total) lastLeg = candidate;
                }
                var heading = parseFloat((total - lastLeg).toFixed(1));
                if(heading <= 0) heading = total; 
                tripData[i].headingKm = heading; 
                tripData[i].totalKm = total;     
                recalcAll(); render();
            } else {
                setTimeout(function(){
                    var v = prompt('âš ï¸ æœªç™¼ç¾å…¬é‡Œæ•¸ï¼Œè«‹æ‰‹å‹•è¼¸å…¥ [èªå®šå–®ç¨‹]:');
                    if(v && !isNaN(v)){ 
                        tripData[i].headingKm = parseFloat(v); 
                        tripData[i].totalKm = parseFloat(v);
                        recalcAll(); render(); 
                    }
                }, 100);
            }
        }

        function recalcAll(){
            var days = {};
            tripData.forEach(t => {
                if(!days[t.date]) days[t.date] = {maxHeading:0, trips:[]};
                if(t.headingKm > days[t.date].maxHeading) days[t.date].maxHeading = t.headingKm;
                days[t.date].trips.push(t);
            });
            Object.values(days).forEach(d => {
                var maxKm = d.maxHeading;
                var dailyCap = 0;
                if(maxKm >= 60) dailyCap = 400;
                else if(maxKm >= 30) dailyCap = 300;
                else if(maxKm >= 5) dailyCap = 200;
                else dailyCap = 0;

                d.trips.forEach(t => {
                    var tripRate = 0;
                    if(t.headingKm >= 60) tripRate = 400;
                    else if(t.headingKm >= 30) tripRate = 300;
                    else if(t.headingKm >= 5) tripRate = 200;
                    
                    t.calcMisc = (t.duration <= 4) ? (tripRate / 2) : tripRate;
                    t.finalMisc = t.calcMisc; 
                    t.isCapped = false;
                });

                var total = d.trips.reduce((acc, t) => acc + t.finalMisc, 0);
                var excess = total - dailyCap;

                if(excess > 0){
                    for(var i=d.trips.length-1; i>=0; i--){
                        if(excess <= 0) break;
                        var t = d.trips[i];
                        if(t.finalMisc > 0){
                            var deduct = Math.min(t.finalMisc, excess);
                            t.finalMisc -= deduct;
                            excess -= deduct;
                            t.isCapped = true; 
                        }
                    }
                }
            });
            tripData.forEach(t => {
                var noteTotalKm = 0;
                if(t.isRound){
                    t.calcCarKm = t.headingKm * 2;
                    noteTotalKm = t.calcCarKm;
                } else {
                    var realTotal = t.totalKm > 0 ? t.totalKm : t.headingKm;
                    t.calcCarKm = realTotal;
                    noteTotalKm = realTotal;
                }
                t.noteText = 'å–®ç¨‹'+t.headingKm+'KM/å…¨ç¨‹'+noteTotalKm+'KM';
                t.carFee = t.vehicle==='car'?Math.floor(t.calcCarKm*3):0;
                t.scooterFee = t.vehicle==='scooter'?Math.floor(t.calcCarKm*2):0;
            });
        }

    } else {
        /* === WebITR ç«¯é‚è¼¯ === */
        var old = document.getElementById('v65-itr');
        if(old) document.body.removeChild(old);

        var box = document.createElement('div');
        box.id = 'v65-itr';
        Object.assign(box.style, {
            position:'fixed', top:'10px', right:'10px', width:'350px',
            backgroundColor:'white', border:'3px solid #8e44ad', zIndex:'2147483647',
            borderRadius:'8px', padding:'10px', boxShadow:'0 10px 40px rgba(0,0,0,0.5)',
            fontFamily:'Arial, sans-serif'
        });

        var html = '<h3 style="margin:0 0 10px 0;color:#8e44ad;text-align:center;">ğŸ¢ WebITR ç¸½ç®¡ V65</h3>';
        html += '<div style="padding:10px;background:#f9f9f9;border-radius:5px;margin-bottom:10px;">';
        html += '<button id="v65-copy" style="width:100%;padding:10px;background:#8e44ad;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:bold;">ğŸ“‹ è¤‡è£½è¡Œç¨‹ (å»åœ°åœ–)</button>';
        html += '</div>';
        html += '<div style="padding:10px;background:#f0fbf5;border-radius:5px;">';
        html += '<div style="font-weight:bold;font-size:12px;color:#2c3e50;margin-bottom:5px;">å¡«å¯«çµæœï¼š</div>';
        html += '<button id="v65-autofill" style="width:100%;padding:12px;background:#27ae60;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:bold;font-size:14px;">ğŸš€ ä¸€éµè‡ªå‹•å¡«å¯«</button>';
        html += '<div id="v65-fallback" style="display:none;margin-top:10px;">';
        html += '<div style="font-size:11px;color:#c0392b;margin-bottom:3px;">âš ï¸ è‡ªå‹•å¤±æ•—ï¼Œè«‹æ‰‹å‹•è²¼ä¸Š JSONï¼š</div>';
        html += '<textarea id="v65-json-input" style="width:95%;height:60px;border:1px solid #ccc;font-size:11px;"></textarea>';
        html += '<button id="v65-manual-fill" style="width:100%;margin-top:5px;padding:8px;background:#95a5a6;color:white;border:none;border-radius:4px;cursor:pointer;">åŸ·è¡Œæ‰‹å‹•å¡«å¯«</button>';
        html += '</div></div>';
        html += '<button id="v65-close-itr" style="width:100%;margin-top:10px;padding:5px;background:#eee;border:none;cursor:pointer;">é—œé–‰</button>';

        box.innerHTML = html;
        document.body.appendChild(box);

        document.getElementById('v65-close-itr').onclick = function(){ document.body.removeChild(box); };

        document.getElementById('v65-copy').onclick = function(){
            var rows = document.querySelectorAll('tr');
            var trips = [];
            var dateRx = /\\d{1,2}-\\d{1,2}.*\\d{2}:\\d{2}/;
            var junk = /å‡ºå‹¤æ™‚æ•¸|åˆ·å¡|ç™¼é€äºº|ç³»çµ±|å·²è®€|åˆªé™¤|å·®å‡/;
            rows.forEach(tr => {
                var t = tr.innerText.replace(/\\s+/g,' ').trim();
                if(dateRx.test(t) && !junk.test(t)) trips.push(t);
            });
            if(trips.length===0){ alert('âŒ æŠ“ä¸åˆ°è¡Œç¨‹ã€‚'); return; }
            copyText(JSON.stringify(trips));
            alert('âœ… å·²è¤‡è£½ '+trips.length+' ç­†è¡Œç¨‹ï¼');
        };

        document.getElementById('v65-autofill').onclick = function(){
            navigator.clipboard.readText().then(text => { doFill(text); })
            .catch(e => { document.getElementById('v65-fallback').style.display='block'; });
        };

        document.getElementById('v65-manual-fill').onclick = function(){
            var val = document.getElementById('v65-json-input').value;
            if(val) doFill(val);
        };

        function doFill(jsonStr){
            try {
                var fillData = JSON.parse(jsonStr);
                if(!confirm('æº–å‚™å¡«å¯« '+fillData.length+' ç­†è³‡æ–™ã€‚\\n\\nâš ï¸ ç¢ºèª [ç”³è«‹] æŒ‰éˆ•å·²å±•é–‹ï¼')) return;
                var allTr = Array.from(document.querySelectorAll('tr')).filter(tr => tr.style.display!=='none' && tr.querySelector('input[type=text], textarea'));
                var count = 0;
                fillData.forEach((item, index) => {
                    if(index >= allTr.length) return;
                    var tr = allTr[index];
                    var inps = Array.from(tr.querySelectorAll('input[type=text], textarea'));
                    var len = inps.length;
                    /* V65: æ¬„ä½å®šä½ (-4, -6, -8, -9) */
                    if(len < 10) return;
                    var noteInput = inps[len-4];
                    var miscInput = inps[len-6];
                    var scooterInput = inps[len-8];
                    var carInput = inps[len-9];
                    if(noteInput) setVal(noteInput, item.note);
                    if(miscInput) setVal(miscInput, item.misc);
                    if(scooterInput) setVal(scooterInput, item.scooter);
                    if(carInput) setVal(carInput, item.car);
                    tr.style.borderLeft = '5px solid #27ae60'; count++;
                });
                alert('âœ… å¡«å¯«å®Œæˆï¼å…± '+count+' ç­†ã€‚');
            } catch(e) { alert('âŒ JSON éŒ¯èª¤'); }
        }

        function setVal(el, val){
            if(!el) return;
            el.value = val; 
            el.dispatchEvent(new Event('input',{bubbles:true})); 
            el.dispatchEvent(new Event('change',{bubbles:true})); 
            el.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter', code: 'Enter', keyCode: 13, bubbles: true }));
            el.dispatchEvent(new KeyboardEvent('keyup', { key: 'Enter', code: 'Enter', keyCode: 13, bubbles: true }));
            el.dispatchEvent(new Event('blur',{bubbles:true})); 
            el.style.backgroundColor = '#d5f5e3'; 
        }
    }

    function copyText(str){
        var el = document.createElement('textarea');
        el.value = str; document.body.appendChild(el);
        el.select(); document.execCommand('copy');
        document.body.removeChild(el);
    }
})();
void(0);`;

/* é—œéµä¿®æ­£ï¼šä½¿ç”¨ encodeURIComponent é€²è¡Œæ¨™æº–ç·¨ç¢¼ */
var encoded = "javascript:" + encodeURIComponent(v65Raw);
document.getElementById('theBookmark').href = encoded;

</script>

</body>
</html>